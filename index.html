<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Your ZIP Code Census Data</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; padding: 2rem; max-width: 600px; margin: auto; }
    h1 { text-align: center; margin-bottom: 1.5rem; }
    .results { background: #fff; padding: 1.5rem; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
    .section { margin-bottom: 1rem; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Your Census Data</h1>
  <div id="results" class="results">
    <p>Detecting your location...</p>
  </div>

  <script>
  async function getZipFromIP() {
    try {
      // More reliable free IP geolocation API
      const geoRes = await fetch("https://ipinfo.io/json?token=YOUR_IPINFO_TOKEN");
      const geoData = await geoRes.json();
      return geoData.postal || null;
    } catch (err) {
      console.error("Geo API error:", err);
      return null;
    }
  }

  async function fetchCensusData(zip) {
    const resDiv = document.getElementById('results');
    try {
      const censusKey = '9b922ba186beb6bba0c82eb87ddb182798303bcc'; // Get from https://api.census.gov/data/key_signup.html

      const url = `https://api.census.gov/data/2021/acs/acs5?get=NAME,B01002_001E,B25010_001E,B15003_001E,B15003_022E,B15003_023E,B15003_024E,B15003_025E&for=zip%20code%20tabulation%20area:${zip}&key=${censusKey}`;
      const res = await fetch(url);
      const data = await res.json();

      if (data.length >= 2) {
        const [ , [place, medianAge, householdSize, eduTotal, bach, master, prof, doctor] ] = data;

        const bachPlus = Number(bach) + Number(master) + Number(prof) + Number(doctor);
        const eduPercent = eduTotal > 0 ? ((bachPlus / Number(eduTotal)) * 100).toFixed(1) : 'N/A';

        resDiv.innerHTML = `
          <div class="section">
            <h2>${place}</h2>
            <p><strong>ZIP Code:</strong> ${zip}</p>
            <p><strong>Median Age:</strong> ${Number(medianAge).toFixed(1)}</p>
            <p><strong>Average Household Size:</strong> ${Number(householdSize).toFixed(2)}</p>
            <p><strong>Bachelor's Degree or Higher:</strong> ${eduPercent}%</p>
          </div>`;
      } else {
        resDiv.innerHTML = `<p class="error">No data found for ZIP ${zip}.</p>`;
      }
    } catch (err) {
      console.error(err);
      resDiv.innerHTML = '<p class="error">Error fetching census data.</p>';
    }
  }

  (async () => {
    const resDiv = document.getElementById('results');
    const zip = await getZipFromIP();
    if (zip) {
      resDiv.innerHTML = `<p>Detected ZIP: ${zip}. Fetching Census data...</p>`;
      fetchCensusData(zip);
    } else {
      resDiv.innerHTML = '<p class="error">Could not detect your ZIP code.</p>';
    }
  })();
  </script>
</body>
</html>

